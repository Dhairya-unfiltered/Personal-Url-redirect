<h1>Welcome <%= user.email %></h1>
<a href="/editprofile">Edit profile</a>
<br><br>
<button onclick="generateDummy()">Generate Dummy Link</button>

<table border="1">
  <tr>
    <th>Dummy Link</th>
    <th>Actual Link + Save</th>
    <th>Copy Button</th>
  </tr>
  <% urls.forEach(url => { %>
    <tr>
      <td>https://zaxurl.vercel.app/<%= url.dummylink %></td>
      <td>
        <input type="text" value="<%= url.actuallink || '' %>" id="input-<%= url._id %>">
        <button onclick="saveLink('<%= url.dummylink %>', '<%= url._id %>')">Save</button>
      </td>
      <td>
        <button onclick="copyToClipboard('https://zaxurl.vercel.app/<%= url.dummylink %>')">Copy</button>
      </td>
    </tr>
  <% }) %>
</table>

<script>
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => alert("Copied!"));
  }

  async function saveLink(dummylink, id) {
    const value = document.getElementById("input-" + id).value;
    await fetch("/edit/" + dummylink, {
      method: "PATCH",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ actuallink: value })
    });
    alert("Saved");
  }

  async function generateDummy() {
    await fetch("/generate", { method: "POST" });
    location.reload();
  }
</script>
